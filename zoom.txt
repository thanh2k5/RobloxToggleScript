local Players = game:GetService("Players")
local UIS = game:GetService("UserInputService")
local RunService = game:GetService("RunService")

local player = Players.LocalPlayer
local camera = workspace.CurrentCamera

-- ===== CONFIG =====
local DEFAULT_ZOOM = 10
local MIN_ZOOM = 2
local MAX_ZOOM = 200       -- tăng xa hơn (bạn có thể để 300/500 tùy game cho phép)
local STEP_TAP = 2         -- bấm 1 cái tăng/giảm bao nhiêu
local SPEED_HOLD = 120     -- giữ để zoom: đơn vị studs/giây (mượt)

-- Camera setup
camera.CameraType = Enum.CameraType.Custom
player.CameraMode = Enum.CameraMode.Classic

local zoom = DEFAULT_ZOOM
player.CameraMinZoomDistance = zoom
player.CameraMaxZoomDistance = zoom

local function applyZoom(z)
	zoom = math.clamp(z, MIN_ZOOM, MAX_ZOOM)
	player.CameraMinZoomDistance = zoom
	player.CameraMaxZoomDistance = zoom
end

-- ===== GUI =====
local gui = Instance.new("ScreenGui")
gui.Name = "ZoomGui"
gui.ResetOnSpawn = false
gui.Parent = player:WaitForChild("PlayerGui")

local frame = Instance.new("Frame")
frame.Parent = gui
frame.Size = UDim2.new(0, 40, 0, 40)
frame.Position = UDim2.new(0, 10, 0.7, 0)
frame.BackgroundTransparency = 1
frame.Active = true -- để kéo mượt hơn (mobile)

-- Toggle ≡
local toggle = Instance.new("TextButton")
toggle.Parent = frame
toggle.Size = UDim2.new(0, 15, 0, 15)
toggle.Position = UDim2.new(0, 12, 0, 0)
toggle.Text = "≡"
toggle.BackgroundColor3 = Color3.fromRGB(200, 200, 200)
toggle.TextSize = 10

-- +
local plus = Instance.new("TextButton")
plus.Parent = frame
plus.Size = UDim2.new(0, 18, 0, 18)
plus.Position = UDim2.new(0, 2, 0, 20)
plus.Text = "+"
plus.BackgroundColor3 = Color3.fromRGB(0, 255, 0)
plus.TextSize = 14

-- -
local minus = Instance.new("TextButton")
minus.Parent = frame
minus.Size = UDim2.new(0, 18, 0, 18)
minus.Position = UDim2.new(0, 20, 0, 20)
minus.Text = "-"
minus.BackgroundColor3 = Color3.fromRGB(255, 0, 0)
minus.TextSize = 14

-- ===== HOLD ZOOM (tối ưu) =====
local holdDir = 0 -- -1 zoom gần, +1 zoom xa
local holdConn = nil

local function stopHold()
	holdDir = 0
	if holdConn then
		holdConn:Disconnect()
		holdConn = nil
	end
end

local function startHold(dir)
	holdDir = dir
	if holdConn then return end
	holdConn = RunService.RenderStepped:Connect(function(dt)
		if holdDir == 0 then return end
		applyZoom(zoom + holdDir * SPEED_HOLD * dt)
	end)
end

-- Tap 1 cái
plus.MouseButton1Click:Connect(function() applyZoom(zoom - STEP_TAP) end)  -- zoom gần hơn
minus.MouseButton1Click:Connect(function() applyZoom(zoom + STEP_TAP) end) -- zoom xa hơn
plus.TouchTap:Connect(function() applyZoom(zoom - STEP_TAP) end)
minus.TouchTap:Connect(function() applyZoom(zoom + STEP_TAP) end)

-- Hold (PC + Mobile)
plus.MouseButton1Down:Connect(function() startHold(-1) end)
minus.MouseButton1Down:Connect(function() startHold(1) end)

plus.MouseButton1Up:Connect(stopHold)
minus.MouseButton1Up:Connect(stopHold)

plus.InputEnded:Connect(function(input)
	if input.UserInputType == Enum.UserInputType.Touch then stopHold() end
end)
minus.InputEnded:Connect(function(input)
	if input.UserInputType == Enum.UserInputType.Touch then stopHold() end
end)

UIS.InputEnded:Connect(function(input)
	-- thả tay ra ngoài nút vẫn dừng (mobile)
	if input.UserInputType == Enum.UserInputType.Touch then
		stopHold()
	end
end)

-- ===== Ẩn/hiện =====
local menuVisible = true
toggle.MouseButton1Click:Connect(function()
	menuVisible = not menuVisible
	plus.Visible = menuVisible
	minus.Visible = menuVisible
end)

-- ===== Kéo menu (mobile) =====
local dragging = false
local dragStart, startPos

frame.InputBegan:Connect(function(input)
	if input.UserInputType == Enum.UserInputType.Touch then
		dragging = true
		dragStart = input.Position
		startPos = frame.Position
	end
end)

UIS.InputChanged:Connect(function(input)
	if dragging and input.UserInputType == Enum.UserInputType.Touch then
		local delta = input.Position - dragStart
		frame.Position = UDim2.new(
			startPos.X.Scale, startPos.X.Offset + delta.X,
			startPos.Y.Scale, startPos.Y.Offset + delta.Y
		)
	end
end)

UIS.InputEnded:Connect(function(input)
	if input.UserInputType == Enum.UserInputType.Touch then
		dragging = false
	end
end)

-- Apply default
applyZoom(DEFAULT_ZOOM)
